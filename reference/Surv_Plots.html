<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate Survival Plots — Surv_Plots • safuncs</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Survival Plots — Surv_Plots"><meta name="description" content="Produces a Kaplan-Meier Survival Plot and/or Hazard Time Plot from survival data. Each plot contains multiple curves for the different treatment groups. Curves for each tank can also be generated using the argument plot_bytank = TRUE. Plots saved by automatically to working directory."><meta property="og:description" content="Produces a Kaplan-Meier Survival Plot and/or Hazard Time Plot from survival data. Each plot contains multiple curves for the different treatment groups. Curves for each tank can also be generated using the argument plot_bytank = TRUE. Plots saved by automatically to working directory."><meta property="og:image" content="https://sean4andrew.github.io/safuncs/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">safuncs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/safuncs.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sean4andrew/safuncs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generate Survival Plots</h1>
      <small class="dont-index">Source: <a href="https://github.com/sean4andrew/safuncs/blob/master/R/safuncs.R" class="external-link"><code>R/safuncs.R</code></a></small>
      <div class="d-none name"><code>Surv_Plots.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produces a Kaplan-Meier Survival Plot and/or Hazard Time Plot from survival data. Each plot contains multiple curves for the different treatment groups. Curves for each tank can also be generated using the argument <code>plot_bytank = TRUE</code>. Plots saved by automatically to working directory.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Surv_Plots</span><span class="op">(</span></span>
<span>  <span class="va">surv_db</span>,</span>
<span>  xlim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Days Post Challenge"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  phi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dailybin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  colours <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  theme <span class="op">=</span> <span class="st">"ggplot"</span>,</span>
<span>  trt_order <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data_out <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_bytank <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_save <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_prefix <span class="op">=</span> <span class="st">"ONDA_XX"</span>,</span>
<span>  plot_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-surv-db">surv_db<a class="anchor" aria-label="anchor" href="#arg-surv-db"></a></dt>
<dd><p>A survival dataframe as described in <b>Details</b>.</p></dd>


<dt id="arg-xlim">xlim<a class="anchor" aria-label="anchor" href="#arg-xlim"></a></dt>
<dd><p>A vector specifying the plots x-axis lower and upper limits, respectively.</p></dd>


<dt id="arg-ylim">ylim<a class="anchor" aria-label="anchor" href="#arg-ylim"></a></dt>
<dd><p>A vector specifying the Survival Plot y-axis lower and upper limits, respectively. Defaults to c(0, 1) which indicates 0 to 100% Survival Probability, respectively.</p></dd>


<dt id="arg-xlab">xlab<a class="anchor" aria-label="anchor" href="#arg-xlab"></a></dt>
<dd><p>A string specifying the plot x-axis label. Defaults to "Days Post Challenge".</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>Smoothing value for the hazard curve. Higher lambda produces greater smoothing. Defaults to NULL where <code><a href="https://rdrr.io/pkg/bshazard/man/bshazard.html" class="external-link">bshazard::bshazard()</a></code> uses the provided survival data to estimate lambda; NULL specification is recommended for large sample size situations which usually occurs on our full-scale studies with many mortalities and tank-replication. At low sample sizes, the lambda estimate can be unreliable. Choosing a lambda of 10 (or anywhere between 1-100) probably produces the most accurate hazard curve for these situations. In place of choosing lambda, choosing <code>phi</code> is recommended; see below.</p></dd>


<dt id="arg-phi">phi<a class="anchor" aria-label="anchor" href="#arg-phi"></a></dt>
<dd><p>Dispersion parameter for the count model used in hazard curve estimation. Defaults to NULL where <code>bshazard()</code> uses the provided survival data to estimate phi; NULL specification is recommended for large sample size situations. At low sample sizes, the phi estimate can be unreliable. Choosing a phi value of 1 for low sample sizes is recommended. This value of 1 (or close) seems to be that estimated in past Tenaci data (QCATC997; phi ~ 0.8-1.4) where there are large sample sizes with tank-replication. The phi value of 1 indicates the set of counts (deaths) over time have a Poisson distribution, following the different hazard rates along the curve and are not overdispersed (phi &gt; 1).</p></dd>


<dt id="arg-dailybin">dailybin<a class="anchor" aria-label="anchor" href="#arg-dailybin"></a></dt>
<dd><p>Whether to set time bins at daily (1 TTE) intervals. Refer to the <code>bshazard()</code> documentation for an understanding on the role of bins to hazard curve estimation. Please set to TRUE at low sample sizes and set to FALSE for large sample sizes (often with tank replication), although at large sample sizes either TRUE or FALSE produces similar results usually. Defaults to TRUE.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Which plot to output. Use "surv" for the Kaplan-Meier Survival Curve, "haz" for the Hazard Curve, or "both" for both. Defaults to "both".</p></dd>


<dt id="arg-colours">colours<a class="anchor" aria-label="anchor" href="#arg-colours"></a></dt>
<dd><p>Vector of color codes for the different treatment groups in the plot. Defaults to ggplot2 default palette.</p></dd>


<dt id="arg-theme">theme<a class="anchor" aria-label="anchor" href="#arg-theme"></a></dt>
<dd><p>A string specifying the graphics theme for the plots. Theme "ggplot2" and "prism" currently available. Defaults to "ggplot2".</p></dd>


<dt id="arg-trt-order">trt_order<a class="anchor" aria-label="anchor" href="#arg-trt-order"></a></dt>
<dd><p>Vector representing the order of treatment groups in the plots. Defaults to NULL where alphabetical order is used.</p></dd>


<dt id="arg-data-out">data_out<a class="anchor" aria-label="anchor" href="#arg-data-out"></a></dt>
<dd><p>Whether to print out the survival and/or hazard databases illustrated by the plots. Defaults to FALSE.</p></dd>


<dt id="arg-plot-bytank">plot_bytank<a class="anchor" aria-label="anchor" href="#arg-plot-bytank"></a></dt>
<dd><p>Whether to analyze and plot the data by tanks. Defaults to FALSE.</p></dd>


<dt id="arg-plot-save">plot_save<a class="anchor" aria-label="anchor" href="#arg-plot-save"></a></dt>
<dd><p>Whether to save plots in the working directory.</p></dd>


<dt id="arg-plot-prefix">plot_prefix<a class="anchor" aria-label="anchor" href="#arg-plot-prefix"></a></dt>
<dd><p>A string specifying the prefix for the filename of the saved plots. Defaults to "ONDA_XX".</p></dd>


<dt id="arg-plot-dim">plot_dim<a class="anchor" aria-label="anchor" href="#arg-plot-dim"></a></dt>
<dd><p>Vector representing the dimensions (width, height) with which to save the plot in .tiff and .pptx.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list containing the Kaplan-Meier Survival Curve and the Hazard Curve if <code>plot = "both"</code>. If only one plot is to be calculated and shown, set either <code>plot = "haz"</code> or <code>plot = "surv"</code>.</p>
<p>If <code>data_out = TRUE</code>, returns dataframes associated with the survival plots.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The survival dataset should be a dataframe containing at least 4 different columns:</p><ul><li><p>"Trt.ID" = Labels for treatment groups in the study.</p></li>
<li><p>"Tank.ID" = Labels for tanks in the study (each tank must have a unique label).</p></li>
<li><p>"TTE" = Time to Event. Event depends on "Status".</p></li>
<li><p>"Status" = Value indicating what happened at TTE. 1 for dead fish, 0 for survivors or those sampled and removed.</p></li>
</ul><p>Each row should represent one fish. For an example dataframe, execute <code>data(surv_db_ex)</code> and view.</p>
<p>For details on the statistical methodology used by <code><a href="https://rdrr.io/pkg/bshazard/man/bshazard.html" class="external-link">bshazard::bshazard()</a></code>, refer to: <a href="https://www.researchgate.net/publication/287338889_bshazard_A_Flexible_Tool_for_Nonparametric_Smoothing_of_the_Hazard_Function" class="external-link">here</a>.</p>
<p>General concept: h(t) the hazard function is considered in an count model with the number of deaths as the response variable. I.e, death_count(t) = h(t) * P(t) where P(t) is the number alive as a function of time and h(t) is modeled over time using basis splines. The basis spline curvature<b>s</b> is assumed to have a normal distribution with mean 0 (a random effect). Based on this assumption, the author found that the variance of curvatures (i.e. smoothness) is equal to the over-dispersion (phi) of the death counts related (divided) by some smoothness parameter (lambda). Phi and lambda can be estimated from the data or specified by the user. Specification can be helpful in low sample size situations where overdispersion (phi) estimates have been found to be unreliable and clearly wrong (based on my understanding of realistic estimates and what was estimated in past data with adequate, large sample sizes).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="https://sean4andrew.github.io/safuncs/reference/Surv_Plots.html">Link</a> for executed <b>Examples</b> which includes any figure outputs.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Starting from an example mortality database, we first generate the complete survivor</span></span></span>
<span class="r-in"><span><span class="co"># data using Surv_Gen()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mort_db_ex</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">surv_dat</span> <span class="op">=</span> <span class="fu"><a href="Surv_Gen.html">Surv_Gen</a></span><span class="op">(</span>mort_db <span class="op">=</span> <span class="va">mort_db_ex</span>,</span></span>
<span class="r-in"><span>                    starting_fish_count <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                    last_tte <span class="op">=</span> <span class="fl">54</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Your total number of tanks is: 12"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Your total number of treatment groups is: 4"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Your total number of fish in the output data is: 1200"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create plot by feeding surv_dat to Surv_Plots()!</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Plots</span><span class="op">(</span>surv_db <span class="op">=</span> <span class="va">surv_dat</span>,</span></span>
<span class="r-in"><span>           plot_prefix <span class="op">=</span> <span class="st">"QCATC777"</span>,</span></span>
<span class="r-in"><span>           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">54</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span> <span class="st">"TTE"</span>,</span></span>
<span class="r-in"><span>           plot <span class="op">=</span> <span class="st">"both"</span>,</span></span>
<span class="r-in"><span>           dailybin <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: Dropping  1  rows with duration of follow up &lt; tol</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Survival_Plot</span>
<span class="r-plt img"><img src="Surv_Plots-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Hazard_Plot</span>
<span class="r-plt img"><img src="Surv_Plots-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To get tank-specific plots and insights, set the argument plot_bytank to TRUE.</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Plots</span><span class="op">(</span>surv_db <span class="op">=</span> <span class="va">surv_dat</span>,</span></span>
<span class="r-in"><span>           plot_prefix <span class="op">=</span> <span class="st">"QCATC777"</span>,</span></span>
<span class="r-in"><span>           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">54</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span> <span class="st">"TTE"</span>,</span></span>
<span class="r-in"><span>           plot <span class="op">=</span> <span class="st">"both"</span>,</span></span>
<span class="r-in"><span>           dailybin <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           phi <span class="op">=</span> <span class="fl">1.5</span>, <span class="co">#often needed for accurate estimation in single tank/group cases</span></span></span>
<span class="r-in"><span>           plot_bytank <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Survival_Plot</span>
<span class="r-plt img"><img src="Surv_Plots-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Hazard_Plot</span>
<span class="r-plt img"><img src="Surv_Plots-4.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean Andrew.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

