<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Predict Future Survival — Surv_Pred • safuncs</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predict Future Survival — Surv_Pred"><meta name="description" content="Predict future survival based on comparisons of hazard ratios to reference data. Produces tables summarizing predicted survival rate and hazard ratios for each treatment. Additionally, produces Kaplan-Meier Survival Plots and Hazard Time Curves comparing survival data (surv_db) to its reference (surv_db_ref). Further details of outputs described in Value, methods in Details."><meta property="og:description" content="Predict future survival based on comparisons of hazard ratios to reference data. Produces tables summarizing predicted survival rate and hazard ratios for each treatment. Additionally, produces Kaplan-Meier Survival Plots and Hazard Time Curves comparing survival data (surv_db) to its reference (surv_db_ref). Further details of outputs described in Value, methods in Details."><meta property="og:image" content="https://sean4andrew.github.io/safuncs/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">safuncs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/safuncs.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sean4andrew/safuncs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Predict Future Survival</h1>
      <small class="dont-index">Source: <a href="https://github.com/sean4andrew/safuncs/blob/master/R/safuncs.R" class="external-link"><code>R/safuncs.R</code></a></small>
      <div class="d-none name"><code>Surv_Pred.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Predict future survival based on comparisons of hazard ratios to reference data. Produces tables summarizing predicted survival rate and hazard ratios for each treatment. Additionally, produces Kaplan-Meier Survival Plots and Hazard Time Curves comparing survival data (<code>surv_db</code>) to its reference (<code>surv_db_ref</code>). Further details of outputs described in <b>Value</b>, methods in <b>Details</b>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Surv_Pred</span><span class="op">(</span></span>
<span>  <span class="va">surv_db</span>,</span>
<span>  <span class="va">surv_db_ref</span>,</span>
<span>  pred_tte <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_method <span class="op">=</span> <span class="st">"simple"</span>,</span>
<span>  pred_dailybin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pred_phi <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  pred_lambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot_save <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_prefix <span class="op">=</span> <span class="st">"ONDA_XX"</span>,</span>
<span>  data_out <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-surv-db">surv_db<a class="anchor" aria-label="anchor" href="#arg-surv-db"></a></dt>
<dd><p>A survival dataframe as described in <code><a href="Surv_Plots.html">Surv_Plots()</a></code>, consisting of the four columns named TTE, Status, Trt.ID and Tank.ID. Example: <code>surv_db_ex</code> which is generated using <code><a href="Surv_Gen.html">Surv_Gen()</a></code>.</p></dd>


<dt id="arg-surv-db-ref">surv_db_ref<a class="anchor" aria-label="anchor" href="#arg-surv-db-ref"></a></dt>
<dd><p>A survival dataframe with the same column names as the supplied <code>surv_db</code>. Must only have one Trt.ID which represents the reference used for prediction.</p></dd>


<dt id="arg-pred-tte">pred_tte<a class="anchor" aria-label="anchor" href="#arg-pred-tte"></a></dt>
<dd><p>A numeric representing the time to event at which the survival rate is to be predicted. Defaults to NULL where the maximum TTE observed in <code>surv_db_ref</code> is used.</p></dd>


<dt id="arg-pred-method">pred_method<a class="anchor" aria-label="anchor" href="#arg-pred-method"></a></dt>
<dd><p>A string representing the method used to predict survival rate. Options are "simple" or "adaptive". Methods further discussed in <b>Details</b>. Defaults to "simple".</p></dd>


<dt id="arg-pred-dailybin">pred_dailybin<a class="anchor" aria-label="anchor" href="#arg-pred-dailybin"></a></dt>
<dd><p>Argument ignored if both <code>surv_db</code> and <code>surv_db_ref</code> contains multiple tanks. Whether to use daily (1 TTE interval) time bins in estimating hazard curves. Defaults to TRUE. Further details in <code>Surv_Plots</code>.</p></dd>


<dt id="arg-pred-phi">pred_phi<a class="anchor" aria-label="anchor" href="#arg-pred-phi"></a></dt>
<dd><p>Argument ignored if both <code>surv_db</code> and <code>surv_db_ref</code> contains multiple tanks. A numeric indicating the dispersion parameter to be used in the count model that estimates the reference hazard curve. Defaults to 1.5. Set to NULL for a data driven estimate. Further details in <code>Surv_Plots</code>.</p></dd>


<dt id="arg-pred-lambda">pred_lambda<a class="anchor" aria-label="anchor" href="#arg-pred-lambda"></a></dt>
<dd><p>Argument ignored if both <code>surv_db</code> and <code>surv_db_ref</code> contains multiple tanks. A numeric indicating the smoothing parameter to be used in estimating the reference hazard curve. Ignored if <code>pred_phi</code> is not NULL. Defaults to NULL (data driven estimate). Further details in <code>Surv_Plots</code>.</p></dd>


<dt id="arg-plot-save">plot_save<a class="anchor" aria-label="anchor" href="#arg-plot-save"></a></dt>
<dd><p>Whether to save plot outputs in the working directory. Defaults to TRUE.</p></dd>


<dt id="arg-plot-prefix">plot_prefix<a class="anchor" aria-label="anchor" href="#arg-plot-prefix"></a></dt>
<dd><p>A string specifying the prefix of the filename of the saved plots.  Defaults to "ONDA_XX".</p></dd>


<dt id="arg-data-out">data_out<a class="anchor" aria-label="anchor" href="#arg-data-out"></a></dt>
<dd><p>Whether to output dataframes containing predicted survival rates and hazard ratios.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The output is a list consisting of at least four ggplot2 objects and optionally
two dataframes.</p>
<dl><dt>Comp_SR_Plot</dt>
<dd><p>Kaplan-Meier Survival Curves of treatments in <code>surv_db</code> and <code>surv_db_ref</code>, with the latter color coded black.</p></dd>

 <dt>Comp_HR_Plot</dt>
<dd><p>Hazard Time Curves of treatments in <code>surv_db</code> and <code>surv_db_ref</code>, with the latter color coded black.</p></dd>

 <dt>Pred_SR_Plot</dt>
<dd><p>Plot of the history of predictions for survival rate based on the utilized TTEs depicted in the x-axis. For example, if the x-value is 30, this means the prediction is blind to all data after it and only utilized the TTEs before. The dashed lines indicate what the prediction would be had the TTE of <code>surv_db_ref</code> been offset by +/- 2 days. This is to show sensitivity to discrepancy in disease "starting times" (onset of significant mortality) between <code>surv_db</code> and <code>surv_db_ref</code>.</p></dd>

 <dt>Pred_HR_Plot</dt>
<dd><p>Like 'Pred_SR_Plot' but with Hazard Ratio in the y-axis.</p></dd>

 <dt>Pred_TTE</dt>
<dd><p>A table showing the predicted survival rate 'pred_SR' and hazard ratio 'pred_HR' at the specified TTE (<code>pred_tte</code>). All TTEs from <code>surv_db</code> are used in the prediction.</p></dd>

 <dt>Pred_History</dt>
<dd><p>A table showing the predicted survival rate and hazard ratio using various TTEs available in <code>surv_db</code>.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Placeholder</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="https://sean4andrew.github.io/safuncs/reference/Surv_Pred.html">Link</a> for executed <b>Examples</b> which includes any figure outputs.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Below is a brief tutorial showing how to use Surv_Pred() to predict future survival.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In the first step, we load the data for which survival is to be predicted and its</span></span></span>
<span class="r-in"><span><span class="co"># reference (e.g. a past survival data involving the same disease). The reference must</span></span></span>
<span class="r-in"><span><span class="co"># contain only one treatment group:</span></span></span>
<span class="r-in"><span><span class="va">surv_db_ref</span> <span class="op">=</span> <span class="va">surv_db_ex</span><span class="op">[</span><span class="va">surv_db_ex</span><span class="op">$</span><span class="va">Trt.ID</span> <span class="op">==</span> <span class="st">"D"</span>,<span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For demonstration purposes, we pretend the survival data to be predicted only extends</span></span></span>
<span class="r-in"><span><span class="co"># to 35 TTE / DPC. Survival rate at 54 TTE is to be predicted. To create such data from</span></span></span>
<span class="r-in"><span><span class="co"># the example, I use survival::survSplit(). For real applications, creating the data</span></span></span>
<span class="r-in"><span><span class="co"># this way would be unnecessary, instead refer to safuncs::Surv_Gen().</span></span></span>
<span class="r-in"><span><span class="va">surv_db</span> <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survSplit.html" class="external-link">survSplit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">surv_db_ex</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>, cut <span class="op">=</span> <span class="fl">35</span>, end <span class="op">=</span> <span class="st">"TTE"</span>,</span></span>
<span class="r-in"><span>                              event <span class="op">=</span> <span class="st">"Status"</span>, episode <span class="op">=</span> <span class="st">"Eps"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">surv_db</span> <span class="op">=</span> <span class="va">surv_db</span><span class="op">[</span><span class="va">surv_db</span><span class="op">$</span><span class="va">Eps</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">surv_db</span><span class="op">$</span><span class="va">Trt.ID</span> <span class="op">!=</span> <span class="st">"D"</span>,</span></span>
<span class="r-in"><span>                  <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span> <span class="co">#remove unnecessary rows and columns</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">surv_db</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Tank.ID Trt.ID TTE Status</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1736      C3      C  35      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1738      C3      C  35      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1740      C3      C  35      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1742      C3      C  35      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1744      C3      C  35      0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Next, we feed both datasets to Surv_Pred() and execute!</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Pred</span><span class="op">(</span>surv_db <span class="op">=</span> <span class="va">surv_db</span>,</span></span>
<span class="r-in"><span>          surv_db_ref <span class="op">=</span> <span class="va">surv_db_ref</span>,</span></span>
<span class="r-in"><span>          pred_tte <span class="op">=</span> <span class="fl">54</span>,</span></span>
<span class="r-in"><span>          pred_method <span class="op">=</span> <span class="st">"simple"</span>,</span></span>
<span class="r-in"><span>          plot_save <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>          data_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span> <span class="co">#exclude data output and fourth plot for now for brevity</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The desired 'pred_tte' (54) is greater than the maximum in the reference database (52) given the TTE offset of -2. For this offset, predictions are for 'pred_tte' -2 (i.e. TTE = 52).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Comp_SR_Plot</span>
<span class="r-plt img"><img src="Surv_Pred-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Comp_HR_Plot</span>
<span class="r-plt img"><img src="Surv_Pred-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Pred_SR_Plot</span>
<span class="r-plt img"><img src="Surv_Pred-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In the first two comparative plots, the black line shows the characteristics of the</span></span></span>
<span class="r-in"><span><span class="co"># reference group. Colored lines show treatments from surv_db.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Notably, the third plot shows instability of the survival predictions. Using the</span></span></span>
<span class="r-in"><span><span class="co"># latest TTE, predictions compared to actual survival at 54 TTE is 76 vs 64% (+8%) for</span></span></span>
<span class="r-in"><span><span class="co"># Trt.A, 56 vs 64% (-8%) for Trt.B, and 70 vs 73% (-3%) for Trt.C. Notably, for Trt.B,</span></span></span>
<span class="r-in"><span><span class="co"># predictions took ~ 2 weeks to become close to accurate. A potential culprit is the</span></span></span>
<span class="r-in"><span><span class="co"># low(?) mortality counts that would led to an unreliable estimate of the hazard ratio</span></span></span>
<span class="r-in"><span><span class="co"># on which the survival prediction is based on. Due to sampling variability, early</span></span></span>
<span class="r-in"><span><span class="co"># predictions should be scrutinized.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Next, we attempt to predict survival for an ongoing real study (at the time of</span></span></span>
<span class="r-in"><span><span class="co"># writing). Here, predictions appeared more stable which is to some extent attributed</span></span></span>
<span class="r-in"><span><span class="co"># to the greater mortality counts leading to more reliable hazard ratio estimates.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">Surv_Pred</span><span class="op">(</span>surv_db <span class="op">=</span> <span class="va">surv_db_ex2</span>, <span class="co">#real data with anonymized Trt.IDs</span></span></span>
<span class="r-in"><span>          surv_db_ref <span class="op">=</span> <span class="va">surv_db_ex3</span>, <span class="co">#real past data as reference</span></span></span>
<span class="r-in"><span>          pred_tte <span class="op">=</span> <span class="fl">54</span>,</span></span>
<span class="r-in"><span>          pred_method <span class="op">=</span> <span class="st">"simple"</span>,</span></span>
<span class="r-in"><span>          plot_save <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>          data_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The desired 'pred_tte' (54) is greater than the maximum in the reference database (52) given the TTE offset of -2. For this offset, predictions are for 'pred_tte' -2 (i.e. TTE = 52).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Comp_SR_Plot</span>
<span class="r-plt img"><img src="Surv_Pred-4.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Comp_HR_Plot</span>
<span class="r-plt img"><img src="Surv_Pred-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Pred_SR_Plot</span>
<span class="r-plt img"><img src="Surv_Pred-6.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Pred_HR_Plot</span>
<span class="r-plt img"><img src="Surv_Pred-7.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean Andrew.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

