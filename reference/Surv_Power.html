<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Power for Survival Experiments — Surv_Power • safuncs</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Power for Survival Experiments — Surv_Power"><meta name="description" content='Calculate power for global and/or pairwise hypothesis tests of survival data with support over a range of data structures from different experimental designs. Power calculations can be made to account for inter-tank variation using a mixed cox proportional hazards model (set argument model = "coxph_glmm"). Additionally, power calculations can account for the multiplicity of pairwise comparisons using pairwise_corr. Users can compare power across different experimental designs by specifying each as a list element in Surv_Simul(). A brief tutorial is written in Examples to guide the user on how to use Surv_Power() to calculate power under various scenarios.'><meta property="og:description" content='Calculate power for global and/or pairwise hypothesis tests of survival data with support over a range of data structures from different experimental designs. Power calculations can be made to account for inter-tank variation using a mixed cox proportional hazards model (set argument model = "coxph_glmm"). Additionally, power calculations can account for the multiplicity of pairwise comparisons using pairwise_corr. Users can compare power across different experimental designs by specifying each as a list element in Surv_Simul(). A brief tutorial is written in Examples to guide the user on how to use Surv_Power() to calculate power under various scenarios.'><meta property="og:image" content="https://sean4andrew.github.io/safuncs/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">safuncs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/safuncs.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sean4andrew/safuncs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate Power for Survival Experiments</h1>
      <small class="dont-index">Source: <a href="https://github.com/sean4andrew/safuncs/blob/master/R/safuncs.R" class="external-link"><code>R/safuncs.R</code></a></small>
      <div class="d-none name"><code>Surv_Power.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate power for global and/or pairwise hypothesis tests of survival data with support over a range of data structures from different experimental designs. Power calculations can be made to account for inter-tank variation using a mixed cox proportional hazards model (set argument <code>model = "coxph_glmm"</code>). Additionally, power calculations can account for the multiplicity of pairwise comparisons using <code>pairwise_corr</code>. Users can compare power across different experimental designs by specifying each as a list element in <code><a href="Surv_Simul.html">Surv_Simul()</a></code>. A brief tutorial is written in <b>Examples</b> to guide the user on how to use <code>Surv_Power()</code> to calculate power under various scenarios.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Surv_Power</span><span class="op">(</span></span>
<span>  simul_db <span class="op">=</span> <span class="va">simul_db_ex</span>,</span>
<span>  global_test <span class="op">=</span> <span class="st">"logrank"</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pairwise_test <span class="op">=</span> <span class="st">"logrank"</span>,</span>
<span>  pairwise_corr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"BH"</span><span class="op">)</span>,</span>
<span>  prog_show <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  data_out <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_out <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_lines <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"List Element #"</span>,</span>
<span>  xnames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot_save <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-simul-db">simul_db<a class="anchor" aria-label="anchor" href="#arg-simul-db"></a></dt>
<dd><p>An output from <code><a href="Surv_Simul.html">Surv_Simul()</a></code> which includes the survival dataframe simulated with the desired experimental design parameters.</p></dd>


<dt id="arg-global-test">global_test<a class="anchor" aria-label="anchor" href="#arg-global-test"></a></dt>
<dd><p>A character vector representing the method(s) to use for global hypothesis testing of significance of treatment. Methods available are: "logrank", "wald", "score", "LRT". "logrank" represents the global logrank test of significance. The latter three methods are standard global hypothesis testing methods for models. They are only available when the argument <code>model</code> is specified (i.e. not NULL). "wald" represents the Wald Chisquare Test which assesses whether model parameters (log(hazard ratios)) jointly are significantly different from 0 (i.e. HRs ≠ 1). Wald test can be done for various cox-proportional hazard models that could be relevant to our studies (glm, glmm, and gee). Due to its broad applicability, while also producing practically the same p-value most of the time compared to the other model tests, "wald" is the recommended option of the three. "score" represents the Lagrange multiplier or Score test. 'LRT' represents the likelihood ratio test. Defaults to "logrank" for now due to its ubiquity of use.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A character vector representing the model(s) to fit for hypothesis testing. Models available are: "coxph_glm" and "coxph_glmm" ("cox_gee" may be supported upon request, omitted for reasons not discussed here). "coxph_glm" represents the standard cox proportional hazard model fitted using <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code> with Trt.ID as a fixed factor. "coxph_glmm" represents the mixed cox proportional hazard model fitted using <code><a href="https://rdrr.io/pkg/coxme/man/coxme.html" class="external-link">coxme::coxme()</a></code> with Trt.ID as a fixed factor and Tank.ID as a random factor to account for inter-tank variation. Defaults to NULL where no model is fitted for hypothesis testing.</p></dd>


<dt id="arg-pairwise-test">pairwise_test<a class="anchor" aria-label="anchor" href="#arg-pairwise-test"></a></dt>
<dd><p>A character vector representing the method(s) used for pairwise hypothesis tests. Use "logrank" to calculate power for logrank tests comparing different treatments. Use "EMM" to calculate power using Estimated Marginal Means based on model estimates (from 'coxph_glm' and/or 'coxph_glmm'). Defaults to "logrank".</p></dd>


<dt id="arg-pairwise-corr">pairwise_corr<a class="anchor" aria-label="anchor" href="#arg-pairwise-corr"></a></dt>
<dd><p>A character vector representing the method(s) used to adjust p-values for multiplicity of pairwise comparisons. For clarification, this affects the power of the pairwise comparisons. Methods available are: "tukey", "holm", "hochberg", "hommel", "bonferroni", "BH", "BY", and "none". Under <b>Details</b> (yet to be finished), I discuss the common categories of adjustment methods and provided a recommendation for "BH". Defaults to c("none", "BH").</p></dd>


<dt id="arg-prog-show">prog_show<a class="anchor" aria-label="anchor" href="#arg-prog-show"></a></dt>
<dd><p>Whether to display the progress of <code>Surv_Power()</code> by printing the number of sample sets with p-values calculated. Defaults to TRUE.</p></dd>


<dt id="arg-data-out">data_out<a class="anchor" aria-label="anchor" href="#arg-data-out"></a></dt>
<dd><p>Whether to output dataframes containing the power of global and/or pairwise hypothesis tests. Defaults to TRUE.</p></dd>


<dt id="arg-plot-out">plot_out<a class="anchor" aria-label="anchor" href="#arg-plot-out"></a></dt>
<dd><p>Whether to output plots illustrating the power of global and/or pairwise hypothesis tests. Defaults to TRUE.</p></dd>


<dt id="arg-plot-lines">plot_lines<a class="anchor" aria-label="anchor" href="#arg-plot-lines"></a></dt>
<dd><p>Whether to plot lines connecting points of the same hypothesis test in the plot output. Defaults to TRUE.</p></dd>


<dt id="arg-xlab">xlab<a class="anchor" aria-label="anchor" href="#arg-xlab"></a></dt>
<dd><p>A string representing the x-axis title. Defaults to "List Element #".</p></dd>


<dt id="arg-xnames">xnames<a class="anchor" aria-label="anchor" href="#arg-xnames"></a></dt>
<dd><p>A character vector of names for x-axis labels. Defaults to NULL where names are the list element numbers from <code><a href="Surv_Simul.html">Surv_Simul()</a></code>.</p></dd>


<dt id="arg-plot-save">plot_save<a class="anchor" aria-label="anchor" href="#arg-plot-save"></a></dt>
<dd><p>Whether to save plots as a .tiff in the working directory. Defaults to TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Outputs a list containing any of the following four items depending on input arguments:</p>
<ul><li><p>When <code>global_test ≠ NULL</code> and <code>data_out = TRUE</code>, outputs a dataframe named <code>power_glob_db</code> containing power values calculated for global hypothesis tests. The dataframe consists of six columns:</p><table class="table table"><tr><td><code>model</code></td><td></td><td>The type of model being evaluated in power calculations</td></tr><tr><td><code>global_test</code></td><td></td><td>The global hypothesis test being evaluated</td></tr><tr><td><code>power</code></td><td></td><td>The percentage of p-values below 0.05, i.e. power</td></tr><tr><td><code>power_se</code></td><td></td><td>Standard error for percentages</td></tr><tr><td><code>sample_sets_n</code></td><td></td><td>Number of sample sets used in calculating power</td></tr><tr><td><code>list_element_num</code></td><td></td><td>The list element number associated with the power value calculated</td></tr></table></li>
<li><p>When <code>global_test ≠ NULL</code> and <code>plot_out = TRUE</code>, a plot showing power values for global hypothesis test. Plot corresponds to <code>power_glob_db</code>.</p></li>
<li><p>When <code>pairwise_test ≠ NULL</code> and <code>data_out = TRUE</code>, outputs a dataframe named <code>power_pair_db</code> containing power values for pairwise hypothesis tests. The dataframe consists of eight columns:</p><table class="table table"><tr><td><code>pair</code></td><td></td><td>The treatment groups to be compared</td></tr><tr><td><code>model</code></td><td></td><td>The type of model being evaluated in power calculations</td></tr><tr><td><code>pairwise_test</code></td><td></td><td>The type of pairwise_test being evaluated</td></tr><tr><td><code>pairwise_corr</code></td><td></td><td>The method of p-value correction/adjustments for paiwrise comparisons</td></tr><tr><td><code>power</code></td><td></td><td>The percentage of p-values below 0.05, i.e. power</td></tr><tr><td><code>power_se</code></td><td></td><td>Standard error for percentages</td></tr><tr><td><code>sample_sets_n</code></td><td></td><td>Number of sample sets used in calculating power</td></tr><tr><td><code>list_element_num</code></td><td></td><td>The list element number associated with the power value calculated</td></tr></table></li>
<li><p>When <code>pairwise_test ≠ NULL</code> and <code>plot_out = TRUE</code>, a plot showing power values across list elements. Plot corresponds to <code>power_pair_db</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="https://sean4andrew.github.io/safuncs/reference/Surv_Power.html">Link</a> for web documentation.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Below is a tutorial on how to calculate power using Surv_Power(). The function</span></span></span>
<span class="r-in"><span><span class="co"># calculates power as a percentage of positive (p &lt; 0.05) test conducted on simulated</span></span></span>
<span class="r-in"><span><span class="co"># datasets. Hence, the first step is simulating the data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A past data is retrieved for simulating future datasets:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">haz_db_ex</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">haz_db_ex</span> <span class="op">=</span> <span class="va">haz_db_ex</span><span class="op">[</span><span class="va">haz_db_ex</span><span class="op">$</span><span class="va">Trt.ID</span> <span class="op">==</span> <span class="st">"A"</span>,<span class="op">]</span> <span class="co"># filter for control fish</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">haz_db_ex</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Trt.ID       Hazard Time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      A 1.098677e-10  0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      A 2.321493e-10  1.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      A 4.905294e-10  2.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      A 1.036484e-09  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      A 2.190081e-09  4.5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># As may be clear from the above, we are using the past data's hazard curve properties.</span></span></span>
<span class="r-in"><span><span class="co"># NOTE: Whether the shape of the hazard curve repeats in the future study only matters</span></span></span>
<span class="r-in"><span><span class="co"># to the accuracy of the power calculation when the future study involves fish being</span></span></span>
<span class="r-in"><span><span class="co"># dropped (e.g. due to sampling).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To begin simulating, input the past data to Surv_Simul() with the supposed future</span></span></span>
<span class="r-in"><span><span class="co"># experiment parameters:</span></span></span>
<span class="r-in"><span><span class="va">surv_sim_db_ex1</span> <span class="op">=</span> <span class="fu"><a href="Surv_Simul.html">Surv_Simul</a></span><span class="op">(</span>haz_db <span class="op">=</span> <span class="va">haz_db_ex</span>,</span></span>
<span class="r-in"><span>                            fish_num_per_tank <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                            tank_num_per_trt <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                            treatments_hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            logHR_sd_intertank <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                            n_sim <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>                            prog_show <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#omit progress bar for cleaner output</span></span></span>
<span class="r-in"><span>                            plot_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#omit plotting for efficiency/speed</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:00:02 (hh:mm:ss)"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Above, we simulated 500 datasets with each having 400 fish per treatment and three</span></span></span>
<span class="r-in"><span><span class="co"># treatments total with hazard ratios of 1, 0.7, and 0.5 relative to 'haz_db_ex.'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Next, the simulated data can be supplied to Surv_Power() to calculate power. Below,</span></span></span>
<span class="r-in"><span><span class="co"># power is calculated for the logrank test:</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Power</span><span class="op">(</span>simul_db <span class="op">=</span> <span class="va">surv_sim_db_ex1</span>,</span></span>
<span class="r-in"><span>           global_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_corr <span class="op">=</span> <span class="st">"none"</span>,</span></span>
<span class="r-in"><span>           prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           data_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># remove data output for brevity</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:00:10 (hh:mm:ss)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_global_plot</span>
<span class="r-plt img"><img src="Surv_Power-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_pairwise_plot</span>
<span class="r-plt img"><img src="Surv_Power-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># From the above, we can see that there is a high probability of detecting significance</span></span></span>
<span class="r-in"><span><span class="co"># of treatment using the global test. On the other hand, power to detect differences</span></span></span>
<span class="r-in"><span><span class="co"># between treatment B (HR = 0.7 relative to control) and C (HR = 0.5) is ~ 60%.</span></span></span>
<span class="r-in"><span><span class="co"># Notably, the presented power for pairwise comparisons uses unadjusted p-values.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If there is a need to adjust p-values to provide a guarantee for, for example, the</span></span></span>
<span class="r-in"><span><span class="co"># false discovery rate, then supply the chosen FDR method(s) (e.g. "BH") to the</span></span></span>
<span class="r-in"><span><span class="co"># 'pairwise_corr' argument:</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Power</span><span class="op">(</span>simul_db <span class="op">=</span> <span class="va">surv_sim_db_ex1</span>,</span></span>
<span class="r-in"><span>           global_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_corr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"BH"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           data_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:00:16 (hh:mm:ss)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_global_plot</span>
<span class="r-plt img"><img src="Surv_Power-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_pairwise_plot</span>
<span class="r-plt img"><img src="Surv_Power-4.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># By default, FDR adjustment methods "control" or limit the false discovery rate to 5%;</span></span></span>
<span class="r-in"><span><span class="co"># true FDR would be lower.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If for some reason there is a need to control for family-wise error rate due to a</span></span></span>
<span class="r-in"><span><span class="co"># desire to conclude at the family-level (already achievable via global test), then p</span></span></span>
<span class="r-in"><span><span class="co"># values can be adjusted using FWER methods (e.g. "bonferroni", "tukey"). Notably, due</span></span></span>
<span class="r-in"><span><span class="co"># to the correlation between pairwise tests, the tukey method is possible and is more</span></span></span>
<span class="r-in"><span><span class="co"># powerful than bonferroni. The tukey option is available if a model is specified:</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Power</span><span class="op">(</span>simul_db <span class="op">=</span> <span class="va">surv_sim_db_ex1</span>,</span></span>
<span class="r-in"><span>           model <span class="op">=</span> <span class="st">"coxph_glm"</span>,</span></span>
<span class="r-in"><span>           global_test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logrank"</span>, <span class="st">"wald"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           pairwise_test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logrank"</span>, <span class="st">"EMM"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           pairwise_corr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"tukey"</span>, <span class="st">"bonferroni"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           data_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "NOTE: Tukey pairwise correction is not available for log-rank tests. No power value is returned for such a combination of test and correction."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:01:10 (hh:mm:ss)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_global_plot</span>
<span class="r-plt img"><img src="Surv_Power-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_pairwise_plot</span>
<span class="r-plt img"><img src="Surv_Power-6.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Based on the pairwise plot above, it seems that the tukey method is only marginally</span></span></span>
<span class="r-in"><span><span class="co"># more powerful in this case compared to bonferroni. The model used above was the cox</span></span></span>
<span class="r-in"><span><span class="co"># proportional hazards model. The global test option "wald" corresponds to a wald</span></span></span>
<span class="r-in"><span><span class="co"># chi-square test of the significance of treatment as a model factor. The pairwise</span></span></span>
<span class="r-in"><span><span class="co"># test option "EMM" corresponds to treatment comparisons using model estimated</span></span></span>
<span class="r-in"><span><span class="co"># marginal means. Notably, the model methods appear to produced similar result to the</span></span></span>
<span class="r-in"><span><span class="co"># logrank test, at least in this example.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># More sophisticated models may be fitted to account for tank variation if any was</span></span></span>
<span class="r-in"><span><span class="co"># introduced in the simulation process as below:</span></span></span>
<span class="r-in"><span><span class="va">surv_sim_db_ex2</span> <span class="op">=</span> <span class="fu"><a href="Surv_Simul.html">Surv_Simul</a></span><span class="op">(</span>haz_db <span class="op">=</span> <span class="va">haz_db_ex</span>,</span></span>
<span class="r-in"><span>                             fish_num_per_tank <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                             tank_num_per_trt <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                             treatments_hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             logHR_sd_intertank <span class="op">=</span> <span class="fl">0.2</span>,</span></span>
<span class="r-in"><span>                             n_sim <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>                             prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                             plot_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:00:02 (hh:mm:ss)"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To calculate power considering the tank variation, we fit a mixed model (coxph_glmm):</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Power</span><span class="op">(</span>simul_db <span class="op">=</span> <span class="va">surv_sim_db_ex2</span>,</span></span>
<span class="r-in"><span>           model <span class="op">=</span> <span class="st">"coxph_glmm"</span>,</span></span>
<span class="r-in"><span>           global_test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logrank"</span>, <span class="st">"wald"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           pairwise_test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logrank"</span>, <span class="st">"EMM"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           pairwise_corr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           data_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:01:11 (hh:mm:ss)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_global_plot</span>
<span class="r-plt img"><img src="Surv_Power-7.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_pairwise_plot</span>
<span class="r-plt img"><img src="Surv_Power-8.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The above results show a property of the test that accounted for tank variation;</span></span></span>
<span class="r-in"><span><span class="co"># it is weaker than the one that does not (logrank test) given the data has tank</span></span></span>
<span class="r-in"><span><span class="co"># variability. However, this is for a reason. If you look into the positive rate of</span></span></span>
<span class="r-in"><span><span class="co"># the test comparing Control vs Trt. B (where true HR = 1), it only slightly above 5%</span></span></span>
<span class="r-in"><span><span class="co"># for the mixed model (a real bias for reasons not discussed here). This result is</span></span></span>
<span class="r-in"><span><span class="co"># roughly consistent with the acclaimed alpha or false positive rate of 0.05. In</span></span></span>
<span class="r-in"><span><span class="co"># contrast, the false positive rate for logrank test is much higher at ~20%.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## VARYING EXPERIMENTAL CONDITIONS</span></span></span>
<span class="r-in"><span><span class="co"># As a precautionary measure, it may be important to study power under various scenarios</span></span></span>
<span class="r-in"><span><span class="co"># (e.g. increasing or decreasing strength of pathogen challenge). To do this, specify</span></span></span>
<span class="r-in"><span><span class="co"># each scenario as separate elements of a list in an argument of Surv_Simul():</span></span></span>
<span class="r-in"><span><span class="va">HR_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">HR_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1.5</span> <span class="op">*</span> <span class="va">HR_vec</span>, <span class="co"># strong challenge</span></span></span>
<span class="r-in"><span>               <span class="fl">1.0</span> <span class="op">*</span> <span class="va">HR_vec</span>, <span class="co"># medium challenge</span></span></span>
<span class="r-in"><span>               <span class="fl">0.5</span> <span class="op">*</span> <span class="va">HR_vec</span><span class="op">)</span> <span class="co"># weak challenge</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">surv_sim_db_ex3</span> <span class="op">=</span> <span class="fu"><a href="Surv_Simul.html">Surv_Simul</a></span><span class="op">(</span>haz_db <span class="op">=</span> <span class="va">haz_db_ex</span>,</span></span>
<span class="r-in"><span>                             fish_num_per_tank <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                             tank_num_per_trt <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                             treatments_hr <span class="op">=</span> <span class="va">HR_list</span>,</span></span>
<span class="r-in"><span>                             logHR_sd_intertank <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                             n_sim <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>                             prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                             plot_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:00:05 (hh:mm:ss)"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Next, calculate and compare power across scenarios:</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Power</span><span class="op">(</span>simul_db <span class="op">=</span> <span class="va">surv_sim_db_ex3</span>,</span></span>
<span class="r-in"><span>           global_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_corr <span class="op">=</span> <span class="st">"none"</span>,</span></span>
<span class="r-in"><span>           prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           data_out <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span> <span class="st">"Challenge Strength"</span>,</span></span>
<span class="r-in"><span>           xnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Strong"</span>, <span class="st">"Medium"</span>, <span class="st">"Weak"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:00:28 (hh:mm:ss)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_global_plot</span>
<span class="r-plt img"><img src="Surv_Power-9.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_pairwise_plot</span>
<span class="r-plt img"><img src="Surv_Power-10.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The results show that power for the strong challenge model is generally high.</span></span></span>
<span class="r-in"><span><span class="co"># However, for the weak challenge model, more sample size appears to be needed to</span></span></span>
<span class="r-in"><span><span class="co"># achieve 80% power for some pairwise comparisons. We can investigate at what sample</span></span></span>
<span class="r-in"><span><span class="co"># size would such power be achieved by specifying different sample sizes as separate</span></span></span>
<span class="r-in"><span><span class="co"># list elements in Surv_Simul():</span></span></span>
<span class="r-in"><span><span class="va">fish_num_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">50</span>, to <span class="op">=</span> <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fish_num_vec</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  50  80 110 140 170 200</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fish_num_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fish_num_vec</span><span class="op">)</span> <span class="co"># convert vector elements to list elements</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate the different experimental conditions:</span></span></span>
<span class="r-in"><span><span class="va">surv_sim_db_ex4</span> <span class="op">=</span> <span class="fu"><a href="Surv_Simul.html">Surv_Simul</a></span><span class="op">(</span>haz_db <span class="op">=</span> <span class="va">haz_db_ex</span>,</span></span>
<span class="r-in"><span>                             fish_num_per_tank <span class="op">=</span> <span class="va">fish_num_list</span>,</span></span>
<span class="r-in"><span>                             tank_num_per_trt <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                             treatments_hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                             logHR_sd_intertank <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                             n_sim <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>                             prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                             plot_out <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:00:13 (hh:mm:ss)"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare power across sample sizes:</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Power</span><span class="op">(</span>simul_db <span class="op">=</span> <span class="va">surv_sim_db_ex4</span>,</span></span>
<span class="r-in"><span>           global_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_test <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>           pairwise_corr <span class="op">=</span> <span class="st">"none"</span>,</span></span>
<span class="r-in"><span>           prog_show <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           data_out <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span> <span class="st">"Fish number per tank"</span>,</span></span>
<span class="r-in"><span>           xnames <span class="op">=</span> <span class="va">fish_num_vec</span>,</span></span>
<span class="r-in"><span>           plot_lines <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Time elapsed: 00:01:01 (hh:mm:ss)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_global_plot</span>
<span class="r-plt img"><img src="Surv_Power-11.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $power_pairwise_plot</span>
<span class="r-plt img"><img src="Surv_Power-12.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The results showed that even an increase in sample size (from 100 to 200) result in</span></span></span>
<span class="r-in"><span><span class="co"># only modest gains in power for comparisons B to C. Perhaps a possible future action</span></span></span>
<span class="r-in"><span><span class="co"># then is to ensure the challenge is medium to strong by having higher salinity for</span></span></span>
<span class="r-in"><span><span class="co"># example. The above examples show some possible use case of Surv_Power(), but other</span></span></span>
<span class="r-in"><span><span class="co"># cases can be simulated to understand power in various scenarios. I hope this tool</span></span></span>
<span class="r-in"><span><span class="co"># can help you calculate power for your specific needs!</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean Andrew.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

