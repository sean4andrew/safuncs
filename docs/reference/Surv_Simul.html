<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simulate Survival Data — Surv_Simul • safuncs</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate Survival Data — Surv_Simul"><meta property="og:description" content="Simulates survival data based on a set of user-specified experimental parameters and a reference hazard curve (e.g. hazard curve from the control group). Able to simulate data with inter-cluster (e.g. tank) variation based on the framework of the mixed cox proportional hazards model (coxme::coxme). Able to simulate right censored data (e.g. sampled fish) using sampling_specs argument. Optionally produces a plot illustrating the characteristics of the simulated data and that of the population / truth from which the data (sample) is simulated."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">safuncs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/sean4andrew/safuncs/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate Survival Data</h1>
    <small class="dont-index">Source: <a href="https://github.com/sean4andrew/safuncs/blob/HEAD/R/safuncs.R" class="external-link"><code>R/safuncs.R</code></a></small>
    <div class="hidden name"><code>Surv_Simul.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simulates survival data based on a set of user-specified experimental parameters and a reference hazard curve (e.g. hazard curve from the control group). Able to simulate data with inter-cluster (e.g. tank) variation based on the framework of the mixed cox proportional hazards model (<code><a href="https://rdrr.io/pkg/coxme/man/coxme.html" class="external-link">coxme::coxme</a></code>). Able to simulate right censored data (e.g. sampled fish) using <code>sampling_specs</code> argument. Optionally produces a plot illustrating the characteristics of the simulated data and that of the population / truth from which the data (sample) is simulated.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Surv_Simul</span><span class="op">(</span></span>
<span>  <span class="va">haz_db</span>,</span>
<span>  fish_num_per_tank <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  tank_num_per_trt <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  treatments_hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  logHR_sd_intertank <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  sampling_specs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  plot_out <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pop_out <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_name <span class="op">=</span> <span class="st">"Surv_Simul-Plot-Output"</span>,</span>
<span>  theme <span class="op">=</span> <span class="st">"ggplot2"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-haz-db">haz_db<a class="anchor" aria-label="anchor" href="#arg-haz-db"></a></dt>
<dd><p>A dataframe representing the reference hazard curve; can be generated from <code>bshazard()</code> or <code><a href="Surv_Plots.html">Surv_Plots()</a></code>.</p></dd>


<dt id="arg-fish-num-per-tank">fish_num_per_tank<a class="anchor" aria-label="anchor" href="#arg-fish-num-per-tank"></a></dt>
<dd><p>The number of fish to simulate per tank. Defaults to 100.</p></dd>


<dt id="arg-tank-num-per-trt">tank_num_per_trt<a class="anchor" aria-label="anchor" href="#arg-tank-num-per-trt"></a></dt>
<dd><p>The number of tanks to simulate per treatment group. Defaults to 4.</p></dd>


<dt id="arg-treatments-hr">treatments_hr<a class="anchor" aria-label="anchor" href="#arg-treatments-hr"></a></dt>
<dd><p>A vector representing the hazard ratios of the treatment groups starting with the reference/control (HR = 1). Length of the vector represents the number of treatment groups. Defaults to <code>c(1, 1, 1, 1)</code>.</p></dd>


<dt id="arg-loghr-sd-intertank">logHR_sd_intertank<a class="anchor" aria-label="anchor" href="#arg-loghr-sd-intertank"></a></dt>
<dd><p>The standard deviation of inter-tank variation in the log(HR) scale according to the <code>coxme</code> framework. Defaults to 0 (no inter-tank variation) which has been and quite oftenly, the estimate for Trojan fish data. For reference 0.1 reflects a low inter-tank variation situation, while 0.35 is fairly high but can and has occurred in some experiments.</p></dd>


<dt id="arg-sampling-specs">sampling_specs<a class="anchor" aria-label="anchor" href="#arg-sampling-specs"></a></dt>
<dd><p>A dataframe representing the number / amount of right censored data (e.g. sampled fish) per tank at different times represented by two columns "Amount" and "TTE", respectively. See <b>Examples</b> for example of use. Defaults to NULL (no sampling).</p></dd>


<dt id="arg-n-sim">n_sim<a class="anchor" aria-label="anchor" href="#arg-n-sim"></a></dt>
<dd><p>Number of survival dataset to simulate. Defaults to 1.</p></dd>


<dt id="arg-plot-out">plot_out<a class="anchor" aria-label="anchor" href="#arg-plot-out"></a></dt>
<dd><p>Whether to output the information plot (further details in <b>return</b>). Defaults to TRUE.</p></dd>


<dt id="arg-pop-out">pop_out<a class="anchor" aria-label="anchor" href="#arg-pop-out"></a></dt>
<dd><p>Whether to output a dataframe containing the survival probability values for the population. Defaults to TRUE.</p></dd>


<dt id="arg-plot-name">plot_name<a class="anchor" aria-label="anchor" href="#arg-plot-name"></a></dt>
<dd><p>Character string specifying the name of the saved plot. Defaults to "Surv_Simul-Plot-Output".</p></dd>


<dt id="arg-theme">theme<a class="anchor" aria-label="anchor" href="#arg-theme"></a></dt>
<dd><p>Character string specifying the graphics theme for the plots. Theme "ggplot2" and "prism" currently available. Defaults to "ggplot2".</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>At minimum, returns a simulated survival dataframe consisting of 5 columns: TTE (Time to Event), Status (0 / 1), Trt.ID, Tank.ID, and n_sim which represents the simulation number for the data subsets.</p>
<p>If <code>plot_out = TRUE</code>, outputs a list that additionally contains a Kaplan-Meier survival plot. The plot illustrates the survival curve with end survival rates for the simulated dataset as well as the population. If the number of simulated dataset is greater than 1, multiple curves are drawn representing each and a statement is provided regarding the power to detect the effect of Treatment – specifically, the percent positive (p &lt; 0.05) from a global log-rank test using <code><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survival::survdiff()</a></code>.</p>
<p>If <code>pop_out = TRUE</code>, outputs a list that additionally contains a dataframe representing the survival probability values for the population / truth from which the sample is supposedly taken.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Simulations are based on uniform-probability draws (<em>U</em> ~ (0, 1)) from a set of events which can be expressed through time using the cumulative density function of failures (<em>F(t)</em>, i.e. cumulative mort. curve). <em>F(t)</em> can be transformed to the cumulative hazard function <em>H(t)</em>, hence the relationship between <em>H(t)</em> and uniform draws (<em>U</em> is also known (derivation and equation in <a href="https://epub.ub.uni-muenchen.de/1716/1/paper_338.pdf" class="external-link">Bender et al. (2003)</a>. Because <em>H(t)</em> is related (as the integral) to the hazard function <em>h(t)</em>, and since <em>h(t)</em> is related to effects (e.g. treatment or tank) based on the cox proportional hazards model, such effects can now be incorporated into the simulation process as they can be interacted with <em>U</em>. The simulation process is as follows:</p>
<ol><li><p><code>Surv_Simul()</code> takes a random sample from <em>U</em> (e.g. 0.7).</p></li>
<li><p>U is then transformed into <em>H</em> as their relationship is known (see <a href="https://epub.ub.uni-muenchen.de/1716/1/paper_338.pdf" class="external-link">Bender et al. 2003</a>) as:</p>
<p><em>H = -log(U) ⋅ exp(-log(β))</em>; <em>β</em> representing treatment or tank effects.</p></li>
<li><p>The function <em>H(t)</em> inverse (known from the supplied reference hazard curve) is applied to <em>H</em> to obtain <em>t</em> (time to event) which represents the survival data.</p></li>
<li><p>Data with <em>t</em> beyond the last follow-up period represent survivors (Status set to 0), and below it, represents mortalities (Status set to 1).</p></li>
</ol><p>To verify the correct "randomness" is produced in the simulated survival data, given that adding "randomness" is the whole point of simulations (to me), 5 different validation checks have been performed (documented in a pdf to be uploaded to github). Those checks showed that the HR estimated by fitting two curves sampled from the same population, converges to a mean of 1 (as should be) over many simulations, and across simulations the HR varies as expected (SD of simulated HRs = SE of HR as supposed by the cox model). Those checks also showed that the p-value obtained by applying log-rank test to null (no-effect) simulated datasets, has a distribution that is uniform (as should be), with a false positive rate of 0.05 given the alpha used was 0.05 (as should be). Additionally, power calculated from the simulations equal to the power calculated from an <a href="https://homepage.univie.ac.at/robin.ristl/samplesize.php?test=logrank" class="external-link">online calculator</a>. Last, the checks showed that the variations in a simulated survival curve is similar to that observed in curves simulated using a different, more limited, method (bootstraping / re-sampling with replacement).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="file:///C:/Users/sean4/Documents/GitHub/safuncs/docs/reference/Surv_Simul.html">Link</a> for executed examples which includes the figure outputs.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Starting from an example mortality database, we first generate the complete survivor data using Surv_Gen()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mort_db_ex</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">surv_dat</span> <span class="op">=</span> <span class="fu"><a href="Surv_Gen.html">Surv_Gen</a></span><span class="op">(</span>mort_db <span class="op">=</span> <span class="va">mort_db_ex</span>,</span></span>
<span class="r-in"><span>                    starting_fish_count <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                    last_tte <span class="op">=</span> <span class="fl">54</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Filter for the control group ("A") to use as a reference hazard curve for simulations</span></span></span>
<span class="r-in"><span><span class="va">surv_dat_A</span> <span class="op">=</span> <span class="va">surv_dat</span><span class="op">[</span><span class="va">surv_dat</span><span class="op">$</span><span class="va">Trt.ID</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Estimate the hazard curve of the control group and get the associated hazard dataframe using either bshazard::bshazard() or safuncs::Surv_Plots()$Hazard_DB</span></span></span>
<span class="r-in"><span><span class="va">ref_haz_route_bshazard</span> <span class="op">=</span> <span class="fu">bshazard</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bshazard/man/bshazard.html" class="external-link">bshazard</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">surv_dat_A</span>, <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TTE</span>, <span class="va">Status</span><span class="op">)</span> <span class="op">~</span> <span class="va">Tank.ID</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-in"><span><span class="va">ref_haz_route_bshazard</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ref_haz_route_bshazard</span><span class="op">)</span><span class="op">$</span><span class="va">HazardEstimates</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ref_haz_route_safuncs</span> <span class="op">=</span> <span class="fu">safuncs</span><span class="fu">::</span><span class="fu"><a href="Surv_Plots.html">Surv_Plots</a></span><span class="op">(</span>surv_db <span class="op">=</span> <span class="va">surv_dat_A</span>, data_out <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">Hazard_DB</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate!</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Simul</span><span class="op">(</span>haz_db <span class="op">=</span> <span class="va">ref_haz_route_safuncs</span>,</span></span>
<span class="r-in"><span>           treatments_hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           sampling_specs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Amount <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>                                       TTE <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">surv_plots</span> <span class="co">#sampling of 10 fish at 45 DPC, but otherwise default experimental conditions.</span></span></span>
<span class="r-plt img"><img src="Surv_Simul-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate multiple times to better see if samples are reliable to answer the question: are my future samples likely to be good approximates of the truth / population</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Simul</span><span class="op">(</span>haz_db <span class="op">=</span> <span class="va">ref_haz_route_safuncs</span>,</span></span>
<span class="r-in"><span>           treatments_hr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           sampling_specs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Amount <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>                                       TTE <span class="op">=</span> <span class="fl">45</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           n_sim <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">$</span><span class="va">surv_plots</span></span></span>
<span class="r-plt img"><img src="Surv_Simul-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sean Andrew.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

