<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generate Survival Plots — Surv_Plots • safuncs</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Survival Plots — Surv_Plots"><meta property="og:description" content="Produces a Kaplan-Meier Survival Plot and/or Hazard Time Plot from survival data. Each plot contains multiple curves for the different treatment groups. Plots saved automatically to working directory."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">safuncs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/sean4andrew/safuncs/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate Survival Plots</h1>
    <small class="dont-index">Source: <a href="https://github.com/sean4andrew/safuncs/blob/HEAD/R/safuncs.R" class="external-link"><code>R/safuncs.R</code></a></small>
    <div class="hidden name"><code>Surv_Plots.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Produces a Kaplan-Meier Survival Plot and/or Hazard Time Plot from survival data. Each plot contains multiple curves for the different treatment groups. Plots saved automatically to working directory.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Surv_Plots</span><span class="op">(</span></span>
<span>  <span class="va">surv_db</span>,</span>
<span>  plot_prefix <span class="op">=</span> <span class="st">"plot_prefix"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Days Post Challenge"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  phi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dailybin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  colours <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  theme <span class="op">=</span> <span class="st">"ggplot"</span>,</span>
<span>  trt_order <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data_out <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-surv-db">surv_db<a class="anchor" aria-label="anchor" href="#arg-surv-db"></a></dt>
<dd><p>A survival dataframe as described in <b>Details</b>.</p></dd>


<dt id="arg-plot-prefix">plot_prefix<a class="anchor" aria-label="anchor" href="#arg-plot-prefix"></a></dt>
<dd><p>A string specifying the prefix for the filename of the saved plots.</p></dd>


<dt id="arg-xlim">xlim<a class="anchor" aria-label="anchor" href="#arg-xlim"></a></dt>
<dd><p>A vector specifying the plots x-axis lower and upper limits, respectively.</p></dd>


<dt id="arg-ylim">ylim<a class="anchor" aria-label="anchor" href="#arg-ylim"></a></dt>
<dd><p>A vector specifying the Survival Plot y-axis lower and upper limits, respectively.</p></dd>


<dt id="arg-xlab">xlab<a class="anchor" aria-label="anchor" href="#arg-xlab"></a></dt>
<dd><p>A string specifying the plot x-axis label.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>Smoothing value for the hazard curve. Higher lambda produces greater smoothing. Defaults to NULL where <code>bshazard()</code> uses the provided survival data to estimate lambda; NULL specification is recommended for large sample size situations which usually occurs on our full-scale studies with many mortalities and tank-replication. At low sample sizes, the lambda estimate can be unreliable. Choosing a lambda of 10 (or anywhere between 1-100) probably produces the most accurate hazard curve for these situations. In place of choosing lambda, choosing <code>phi</code> is recommended; see below.</p></dd>


<dt id="arg-phi">phi<a class="anchor" aria-label="anchor" href="#arg-phi"></a></dt>
<dd><p>Dispersion parameter for the count model used in hazard curve estimation. Defaults to NULL where <code>bshazard()</code> uses the provided survival data to estimate phi; NULL specification is recommended for large sample size situations. At low sample sizes, the phi estimate can be unreliable. Choosing a phi value of 1 for low sample sizes is recommended. This value of 1 (or close) seems to be that estimated in past Tenaci data (QCATC997; phi ~ 0.8-1.4) where there are large sample sizes with tank-replication. The phi value of 1 indicates the set of counts (deaths) over time have a Poisson distribution, following the different hazard rates along the curve and are not overdispersed (phi &gt; 1).</p></dd>


<dt id="arg-dailybin">dailybin<a class="anchor" aria-label="anchor" href="#arg-dailybin"></a></dt>
<dd><p>Whether to set time bins at daily (1 TTE) intervals. Refer to the <code>bshazard()</code> documentation for an understanding on the role of bins to hazard curve estimation. Please set to TRUE at low sample sizes and set to FALSE at large sample sizes with tank-replication. Defaults to TRUE.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Which plot to output. Use "surv" for the Kaplan-Meier Survival Curve, "haz" for the Hazard Curve, or "both" for both. Defaults to "both".</p></dd>


<dt id="arg-colours">colours<a class="anchor" aria-label="anchor" href="#arg-colours"></a></dt>
<dd><p>Vector of color codes for the different treatment groups in the plot. Defaults to ggplot2 default palette.</p></dd>


<dt id="arg-theme">theme<a class="anchor" aria-label="anchor" href="#arg-theme"></a></dt>
<dd><p>Character string specifying the graphics theme for the plots. Theme "ggplot2" and "prism" currently available. Defaults to "ggplot2".</p></dd>


<dt id="arg-trt-order">trt_order<a class="anchor" aria-label="anchor" href="#arg-trt-order"></a></dt>
<dd><p>Vector representing the order of treatment groups in the plots. Defaults to NULL where alphabetical order is used.</p></dd>


<dt id="arg-data-out">data_out<a class="anchor" aria-label="anchor" href="#arg-data-out"></a></dt>
<dd><p>Whether to print out the survival and/or hazard databases illustrated by the plots. Defaults to FALSE.</p></dd>


<dt id="arg-plot-dim">plot_dim<a class="anchor" aria-label="anchor" href="#arg-plot-dim"></a></dt>
<dd><p>Vector representing the dimensions (width, height) with which to save the plot in .tiff and .pptx.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>By default, with argument <code>plot = "both"</code>, returns the Kaplan-Meier Survival Curve and the Hazard Curve. Output can be trimmed by setting <code>plot = "haz"</code> or <code>plot = "surv"</code>.</p>
<p>If <code>data_out = TRUE</code>, returns a list of the plot(s) and the associated dataframes to create them.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The survival dataset should be a dataframe containing at least 4 different columns:</p><ul><li><p>"Trt.ID" = Labels for treatment groups in the study.</p></li>
<li><p>"Tank.ID" = Labels for tanks in the study (each tank must have a unique label).</p></li>
<li><p>"TTE" = Time to Event. Event depends on "Status".</p></li>
<li><p>"Status" = Value indicating what happened at TTE. 1 for dead fish, 0 for survivors or those sampled and removed.</p></li>
</ul><p>Each row should represent one fish. For an example dataframe, execute <code>data(surv_db_ex)</code> and view.</p>
<p>For details on the statistical methodology used by <code>bshazard()</code>, refer to: <a href="https://www.researchgate.net/publication/287338889_bshazard_A_Flexible_Tool_for_Nonparametric_Smoothing_of_the_Hazard_Function" class="external-link">here</a>.</p>
<p>General concept: h(t) the hazard function is considered in an count model with the number of deaths as the response variable. I.e, death_count(t) = h(t) * P(t) where P(t) is the number alive as a function of time and h(t) is modeled over time using basis splines. The basis spline curvature<b>s</b> is assumed to have a normal distribution with mean 0 (a random effect). Based on this assumption, the author found that the variance of curvatures (i.e. smoothness) is equal to the over-dispersion (phi) of the death counts related (divided) by some smoothness parameter (lambda). Phi and lambda can be estimated from the data or specified by the user. Specification can be helpful in low sample size situations where overdispersion (phi) estimates have been found to be unreliable and clearly wrong (based on my understanding of realistic estimates and what was estimated in past data with adequate, large sample sizes).</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Starting from an example mortality database, we first generate the complete survivor data using Surv_Gen()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mort_db_ex</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">surv_dat</span> <span class="op">=</span> <span class="fu"><a href="Surv_Gen.html">Surv_Gen</a></span><span class="op">(</span>mort_db <span class="op">=</span> <span class="va">mort_db_ex</span>,</span></span>
<span class="r-in"><span>                    starting_fish_count <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                    last_tte <span class="op">=</span> <span class="fl">54</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Create plot by inputting surv_dat into Surv_Plots()!</span></span></span>
<span class="r-in"><span><span class="fu">Surv_Plots</span><span class="op">(</span>surv_db <span class="op">=</span> <span class="va">surv_dat</span>,</span></span>
<span class="r-in"><span>           plot_prefix <span class="op">=</span> <span class="st">"QCATC777"</span>,</span></span>
<span class="r-in"><span>           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">54</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span> <span class="st">"TTE"</span>,</span></span>
<span class="r-in"><span>           phi <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>           plot <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>package 'gdtools' was built under R version 4.4.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: Dropping  1  rows with duration of follow up &lt; tol</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOTE: entry.status has been set to 0 for all.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Survival_Plot</span>
<span class="r-plt img"><img src="Surv_Plots-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Hazard_Plot</span>
<span class="r-plt img"><img src="Surv_Plots-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sean Andrew.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

