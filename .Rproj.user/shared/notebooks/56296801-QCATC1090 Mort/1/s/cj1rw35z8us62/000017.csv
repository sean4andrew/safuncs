"0","pred_db = Ten_Surv_DB"
"0","pred_tte = 59"
"0","ref_db = Ref_Ten_DBControl2 "
"0","coxph_mod = ""GEE"""
"0","simul = FALSE"
"0","method = 2"
"0","lambda = NULL"
"0","phi = NULL"
"0","pred_history = TRUE"
"0","project = FALSE"
"0",""
"0","  pred_db = pred_db[pred_db$TTE > 0, ] #ensure positive TTE"
"0","  ref_db = ref_db[ref_db$TTE > 0, ] #ensure positive TTE"
"0",""
"0","  #Generate reference level bshazard curve"
"0","  ref_id = levels(as.factor(ref_db$Trt.ID))"
"0","  ref_bshaz = bshazard::bshazard(data = ref_db, survival::Surv(TTE, Status) ~ Tank.ID,"
"0","                                 verbose = FALSE)"
"1","NOTE: entry.status has been set to 0 for all.
"
"0","  #Regenerate ref_db using simulations"
"0","  if(simul == TRUE) {"
"0","    ref_db = Surv_Simul(Haz_DB = ref_bshaz, fish_num_per_tank = 10000, tank_num_per_trt = 5,"
"0","                        Treatments_HR = 1, logHR_sd_intertank = 1e-8, integer_days = TRUE)"
"0","  }"
"0",""
"0","  #add label to reference level"
"0","  ref_db$Trt.ID = paste(""ref"", ref_id)"
"0",""
"0","  #initialize dataframes"
"0","  pred_SR_DB = data.frame()"
"0","  haz_db = data.frame()"
"0","  sr_proj = data.frame()"
"0",""
"0","  #loop for every treatment"
"0","  for(pred_trt in levels(as.factor(pred_db$Trt.ID))) {"
"0",""
"0","    comb_db = rbind(ref_db, pred_db[pred_db$Trt.ID == pred_trt,])"
"0","    comb_db$Trt.ID = relevel(as.factor(comb_db$Trt.ID), ref = paste(""ref"", ref_id))"
"0",""
"0","    #loop for every TTE in pred_db if pred_history == TRUE"
"0","    for(SR_Day in if(pred_history == TRUE) {every_tte <- 1:max(pred_db$TTE)} else {every_tte <- max(pred_db$TTE)}) {"
"0","      comb_db2 = survival::survSplit(comb_db, cut = SR_Day, end = ""TTE"", event = ""Status"", episode = ""Obs"")"
"0","      comb_db2 = comb_db2[comb_db2$Obs == 1, ]"
"0",""
"0","      #Get HR"
"0","      options(contrasts = c(""contr.treatment"", ""contr.poly""))"
"0","      if(coxph_mod == ""GLMM""){cox_comp = tryCatch(coxme::coxme(survival::Surv(TTE, Status) ~ Trt.ID + (1|Tank.ID),"
"0","                                                               data = comb_db2),"
"0","                                                  warning = function(w){cox_comp = TRUE})}"
"0","      if(coxph_mod == ""GEE""){cox_comp = tryCatch(survival::coxph(survival::Surv(TTE, Status) ~ Trt.ID,"
"0","                                                                 cluster = Tank.ID, data = comb_db2),"
"0","                                                 warning = function(w){cox_comp = TRUE})}"
"0","      ifelse(!is.list(cox_comp), pred_HR <- NA, pred_HR <- exp(coef(cox_comp)))"
"0",""
"0","      #Get SR"
"0","      ref_bshaz_t = data.frame(hazard = ref_bshaz$hazard[ref_bshaz$time < pred_tte],"
"0","                               time = ref_bshaz$time[ref_bshaz$time < pred_tte])"
"0",""
"0","      if(method == 1) {"
"0","        if(!is.na(pred_HR)) {"
"0","          cumhaz = DescTools::AUC(x = c(ref_bshaz_t$time),"
"0","                                  y = c(ref_bshaz_t$hazard) * pred_HR)"
"0","          pred_SR = 100 * exp(-cumhaz)"
"0","        } else {pred_SR <- NA}"
"0","      }"
"0",""
"0","      if(method == 2) {"
"0","          pred_db2 = survival::survSplit(pred_db, cut = SR_Day, end = ""TTE"", event = ""Status"", episode = ""Obs"")"
"0","          pred_db2 = pred_db2[pred_db2$Obs == 1, ]"
"0","          pred_bshaz = tryCatch(suppressWarnings(bshazard::bshazard(data = droplevels(pred_db2[pred_db2$Trt.ID == pred_trt,]),"
"0","                                                                    survival::Surv(TTE, Status) ~ Tank.ID, verbose = FALSE, lambda = lambda, phi = phi)),"
"0","                                error = function(e) {pred_bshaz = data.frame(time = 0, hazard = 0)})"
"0",""
"0","          cumhaz_precut = DescTools::AUC(x = c(pred_bshaz$time),"
"0","                                         y = c(pred_bshaz$hazard))"
"0","          ref_bshaz_t2 = data.frame(time = seq(SR_Day, pred_tte, by = 1),"
"0","                                    hazard = approx(xout = seq(SR_Day, pred_tte, by = 1),"
"0","                                                    y = ref_bshaz_t[ref_bshaz_t$time > SR_Day,]$hazard,"
"0","                                                    x = ref_bshaz_t[ref_bshaz_t$time > SR_Day,]$time,"
"0","                                                    rule = 2)$y)"
"0","          if(!is.na(pred_HR)) {"
"0","            cumhaz_postcut = DescTools::AUC(x = c(ref_bshaz_t2$time),"
"0","                                            y = c(ref_bshaz_t2$hazard) * pred_HR)"
"0","            pred_SR = 100 * exp(-(cumhaz_precut + cumhaz_postcut)) "
"0","          } else {pred_SR = 0}"
"0","      }"
"0","      #compile survival prediction database"
"0","      pred_SR_DB = rbind(pred_SR_DB, data.frame(Trt.ID = pred_trt, Observable_SR_Day = SR_Day, pred_SR, pred_HR))"
"0","    }"
"0",""
"0","    if(project == TRUE) {"
"0","    pred_survfit = survival::survfit(survival::Surv(TTE, Status) ~ Trt.ID, data = pred_db[pred_db$Trt.ID == pred_trt,])"
"0","    sr_proj = rbind(sr_proj, data.frame(Trt.ID = pred_trt,"
"0","                                        time = c(pred_survfit$time, ref_bshaz_t2$time[-1]),"
"0","                                        cumhaz = c(pred_survfit$cumhaz,"
"0","                                                   data.table::last(pred_survfit$cumhaz) + cumsum(ref_bshaz_t2$hazard[-1] * pred_HR)),"
"0","                                        projsr = exp(-c(pred_survfit$cumhaz,"
"0","                                                        data.table::last(pred_survfit$cumhaz) + cumsum(ref_bshaz_t2$hazard[-1] * pred_HR))),"
"0","                                        type = c(rep(""observed"", length(pred_survfit$time)), rep(""projected"", length(ref_bshaz_t2$time[-1])))))"
"0","    }"
"0","  }"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"1","NOTE: entry.status has been set to 0 for all.
"
"0","  #remove unreliable HRs or SRs"
"0","  row.names(pred_SR_DB) = NULL"
"0","  pred_SR_DB$pred_HR[is.na(pred_SR_DB$pred_SR)] = NA"
"0","  pred_SR_DB$pred_SR[is.na(pred_SR_DB$pred_HR)] = NA"
"0",""
"0","  #create survival prediction plot"
"0","  library(ggplot2)"
"0","  Pred_SR_Plot = ggplot(data = pred_SR_DB, aes(x = Observable_SR_Day, y = pred_SR, color = Trt.ID)) +"
"0","    geom_point() +"
"0","    geom_line() +"
"0","    facet_wrap(~Trt.ID) +"
"0","    scale_y_continuous(name = paste(""Predicted Survival (%) on TTE = "", pred_tte), breaks = seq(0, 100, 10), limits = c(0, 100)) +"
"0","    scale_x_continuous(name = ""Observable TTEs used in Prediction"", breaks = seq(0, 100, max(round(max(pred_db$TTE) / 15), 1)))"
"0",""
"0","  Pred_HR_Plot = ggplot(data = pred_SR_DB, aes(x = Observable_SR_Day, y = pred_HR, color = Trt.ID)) +"
"0","    geom_point() +"
"0","    geom_line() +"
"0","    facet_wrap(~Trt.ID) +"
"0","    scale_y_continuous(name = paste(""Predicted HR "", pred_tte)) +"
"0","    scale_x_continuous(name = ""Observable TTEs used in Prediction"", breaks = seq(0, 100, max(round(max(pred_db$TTE) / 15), 1)))"
"0",""
"0","  sr_proj_obs = sr_proj[sr_proj$type == ""observed"",]"
"0","  sr_proj_obs_last = sr_proj_obs[sr_proj_obs$time == max(sr_proj_obs$time),]"
"2","Warning in max(sr_proj_obs$time) :"
"2","
 "
"2"," no non-missing arguments to max; returning -Inf
"
"0","  sr_proj_obs_last$time = sr_proj_obs_last$time + 0.65"
"0",""
"0","  Proj_KM_Plot = ggplot(mapping = aes(x = time, y = projsr, color = Trt.ID)) +"
"0","    geom_step(data = sr_proj_obs, linewidth = 1.2) +"
"0","    geom_step(data = rbind(sr_proj_obs_last, sr_proj[sr_proj$type == ""projected"",]), linewidth = 1.2, alpha = 0.45) +"
"0","    scale_y_continuous(name = ""Survival Probability"", breaks = seq(0, 1, 0.1), labels = scales::percent, limits = c(0, 1)) +"
"0","    scale_x_continuous(name = ""Standardized Time"", breaks = seq(0, 100, max(round(max(sr_proj$time) / 15), 1)), limits = c(0, max(sr_proj$time)))"
"2","Warning in max(sr_proj$time) :"
"2","
 "
"2"," no non-missing arguments to max; returning -Inf
"
"2","Warning in max(sr_proj$time) :"
"2","
 "
"2"," no non-missing arguments to max; returning -Inf
"
"0","  if(pred_history == TRUE & project == TRUE) {return(list(pred_db = pred_SR_DB, pred_SR_plot = Pred_SR_Plot,"
"0","                                                          pred_HR_plot = Pred_HR_Plot, proj_surv_plot = Proj_KM_Plot, proj_db = sr_proj))}"
"0","  if(pred_history == TRUE & project == FALSE) {return(list(pred_db = pred_SR_DB, pred_SR_plot = Pred_SR_Plot, pred_HR_plot = Pred_HR_Plot))}"
"2","Error: no function to return from, jumping to top level
"
